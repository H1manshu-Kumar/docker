# STAGE 1 - Build
FROM node:20-alpine AS build

WORKDIR /workspace

# Copy package files first for better caching
COPY weather-app/package*.json ./

# Install dependencies
RUN npm install

# Copy source code
COPY weather-app/ ./

# STAGE 2 - Runtime (Distroless)
FROM gcr.io/distroless/nodejs20-debian12 AS runtime

WORKDIR /app

# Copy built application from build stage
COPY --from=build /workspace /app

# Expose port
EXPOSE 3000

# Run the app
CMD ["app.js"]
